<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>棒球投手分析儀表板</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>
    <style>
        /* 自定義滾動條樣式，讓它更好看一點 */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans antialiased text-gray-800">

    <div id="main-dashboard" class="min-h-screen flex flex-col p-6">
        <header class="bg-white rounded-lg shadow-lg p-6 mb-6 flex justify-between items-center">
            <h1 class="text-3xl font-extrabold text-blue-700">棒球投手分析儀表板</h1>
            <button id="show-history-button" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg shadow transition duration-300">
                查看歷史分析數據
            </button>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 flex-grow">

            <div class="lg:col-span-2 bg-white rounded-lg shadow-lg p-6 flex flex-col">
                <h2 class="text-2xl font-bold text-gray-700 mb-4">上傳影片進行分析</h2>

                <div id="drop-area" class="border-2 border-dashed border-gray-300 rounded-lg p-12 text-center cursor-pointer hover:border-blue-500 hover:bg-blue-50 transition duration-300 relative">
                    <input type="file" id="video-upload" accept="video/*" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer">
                    <p class="text-gray-500">拖曳影片至此或點擊上傳</p>
                    <p class="text-xs text-gray-400 mt-2">支援MP4, MOV, AVI等格式</p>
                </div>
                <button id="upload-button" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg shadow-md mt-6 transition duration-300 w-full disabled:opacity-50 disabled:cursor-not-allowed">
                    開始分析
                </button>

                <div id="upload-status" class="text-gray-600 mt-4 text-center">等待影片上傳...</div>
                <div id="loading-spinner" class="hidden mx-auto mt-2 w-8 h-8 border-4 border-blue-200 border-t-blue-500 rounded-full animate-spin"></div>

                <div class="mt-6 flex-grow flex flex-col items-center justify-center">
                    <h3 class="text-xl font-semibold text-gray-700 mb-3">影片預覽與分析結果</h3>
                    <video id="video-player" controls class="max-h-96 w-full object-contain bg-black rounded-lg shadow-md"></video>
                    <p id="video-player-message" class="text-gray-500 text-sm mt-2">影片將在此處播放，並顯示關鍵影格。</p>
                </div>
            </div>

            <div class="lg:col-span-1 flex flex-col gap-6">
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h2 class="text-2xl font-bold text-gray-700 mb-4">投球表現概覽</h2>
                    <p class="text-gray-700 text-lg mb-2"><strong>投球評分:</strong> <span id="pitch-score" class="text-blue-600 font-bold text-xl">N/A</span> / 9</p>
                    <p class="text-gray-700 text-lg"><strong>球速:</strong> <span id="max-speed" class="text-green-600 font-bold text-xl">N/A</span> km/h</p>
                </div>

                <div class="bg-white rounded-lg shadow-lg p-6 flex-grow">
                    <h2 class="text-2xl font-bold text-gray-700 mb-4">運動力學特徵</h2>
                    <div id="biomechanics-results" class="text-gray-700 text-sm">
                        <ul class="list-disc list-inside space-y-1">
                            <li>釋放影格: <span id="release_frame">N/A</span></li>
                            <li>著地影格: <span id="landing_frame">N/A</span></li>
                            <li>肩膀影格: <span id="shoulder_frame">N/A</span></li>
                            <li>總影格數: <span id="total_frames">N/A</span></li>
                            <li>軀幹屈曲偏移: <span id="trunk_flexion_excursion">N/A</span></li>
                            <li>骨盆傾斜於FC: <span id="pelvis_obliquity_at_fc">N/A</span></li>
                            <li>軀幹旋轉於BR: <span id="trunk_rotation_at_br">N/A</span></li>
                            <li>肩膀外展於BR: <span id="shoulder_abduction_at_br">N/A</span></li>
                            <li>軀幹屈曲於BR: <span id="trunk_flexion_at_br">N/A</span></li>
                            <li>軀幹側向屈曲於HS: <span id="trunk_lateral_flexion_at_hs">N/A</span></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="history-analysis-page" class="min-h-screen flex flex-col p-6 hidden">
        <header class="bg-white rounded-lg shadow-lg p-6 mb-6 flex justify-between items-center">
            <h1 class="text-3xl font-extrabold text-blue-700">歷史分析數據</h1>
            <button id="show-dashboard-button" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg shadow transition duration-300">
                返回主儀表板
            </button>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 flex-grow">
            <div class="bg-white rounded-lg shadow-lg p-6 col-span-full">
                <h2 class="text-2xl font-bold text-gray-700 mb-4">選擇歷史紀錄進行比較</h2>
                <select id="history-record-select" class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></select>
                <div id="selected-record-details" class="mt-4 p-4 bg-gray-50 rounded-md text-sm text-gray-700">
                    <p class="text-center text-gray-500">請從上方下拉選單選擇一個歷史紀錄。</p>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-700 mb-4">投球分數分佈 (直方圖)</h2>
                <canvas id="pitchScoreHistogramChart"></canvas>
            </div>
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-700 mb-4" id="pie-chart-title">運動力學特徵分佈 (圓餅圖)</h2>
                <select id="biomechanics-pie-select" class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4">
                    </select>
                <canvas id="biomechanicsPieChart"></canvas>
            </div>
            <div class="bg-white rounded-lg shadow-lg p-6 col-span-full">
                <h2 class="text-2xl font-bold text-gray-700 mb-4">運動力學特徵表現 (雷達圖)</h2>
                <canvas id="biomechanicsRadarChart"></canvas>
            </div>
             <div class="bg-white rounded-lg shadow-lg p-6 col-span-full">
                <h2 class="text-2xl font-bold text-gray-700 mb-4">歷史紀錄列表</h2>
                <div id="history-list-container" class="overflow-y-auto max-h-96">
                    <ul id="history-list" class="divide-y divide-gray-200">
                        </ul>
                    <p id="no-history-message" class="text-center text-gray-500 py-4 hidden">暫無歷史紀錄。</p>
                </div>
            </div>

        </div>
    </div>


    <script type="module" src="./js/app.js"></script>
</body>
</html>