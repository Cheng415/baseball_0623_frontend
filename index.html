<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>棒球投手分析儀表板</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>
    <style>
        /* 自定義滾動條樣式，讓它更好看一點 */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans antialiased text-gray-800">

    <div id="main-dashboard" class="min-h-screen p-6 transition-all duration-300">
        <header class="mb-8 text-center">
            <h1 class="text-4xl font-extrabold text-blue-700">⚾ 棒球投手分析儀表板 ⚾</h1>
            <p class="text-lg text-gray-600 mt-2">上傳影片，分析您的投球表現！</p>
        </header>

        <main class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <section class="col-span-full grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <div class="bg-white rounded-lg shadow-lg p-6 flex flex-col items-center justify-center">
                    <h2 class="text-2xl font-bold text-gray-700 mb-4">影片上傳區</h2>
                    <div class="w-full max-w-md bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-500 transition-all duration-200 cursor-pointer" id="drop-area">
                        <input type="file" id="video-upload" accept="video/*" class="hidden">
                        <p class="text-gray-500 mb-2">拖曳影片至此，或點擊上傳</p>
                        <button id="upload-button" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-full transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">選擇影片</button>
                    </div>
                    <div id="upload-status" class="mt-4 text-sm text-gray-600"></div>
                    <div id="loading-spinner" class="hidden mt-4">
                        <svg class="animate-spin h-8 w-8 text-blue-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        <p class="mt-2 text-blue-500">正在分析影片，請稍候...</p>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h2 class="text-2xl font-bold text-gray-700 mb-4">影片播放區</h2>
                    <video id="video-player" controls class="w-full h-auto max-h-96 bg-black rounded-md shadow-inner">
                        您的瀏覽器不支持影片播放。
                    </video>
                    <div id="video-player-message" class="mt-2 text-center text-gray-500">上傳影片後將在此處播放分析結果</div>
                </div>
            </section>

            <section class="col-span-full grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h2 class="text-2xl font-bold text-gray-700 mb-4">姿勢評分與運動力學特徵</h2>
                    <div id="biomechanics-results" class="text-gray-700 text-sm">
                        <p><strong>球速:</strong> <span id="max-speed">N/A</span> km/h</p>
                        <h3 class="font-semibold mt-4 mb-2">運動力學特徵:</h3>
                        <ul class="list-disc list-inside space-y-1">
                            <li>平均手肘角度: <span id="avg_elbow_angle">N/A</span> 度</li>
                            <li>平均肩膀傾斜角度: <span id="avg_shoulder_slope_deg">N/A</span> 度</li>
                            <li>平均髖部傾斜角度: <span id="avg_hip_slope_deg">N/A</span> 度</li>
                            <li>平均軀幹扭轉角度: <span id="avg_torso_twist_deg">N/A</span> 度</li>
                            <li>最大手部速度: <span id="max_hand_speed_px_per_s">N/A</span> 像素/秒</li>
                            <li>最大步幅: <span id="max_stride_length_px">N/A</span> 像素</li>
                            <li>最小手肘高度: <span id="min_elbow_height_px">N/A</span> 像素</li>
                            <li>平均頭肘距離: <span id="avg_head_elbow_dist_px">N/A</span> 像素</li>
                            <li>平均肩膀寬度: <span id="avg_shoulder_width_px">N/A</span> 像素</li>
                        </ul>
                        <p class="text-gray-500 text-xs mt-4">數值越接近理想範圍越好。</p>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow-lg p-6 flex flex-col justify-between">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-700 mb-4">模型預測結果</h2>
                        <div id="prediction-results" class="text-center">
                            <p class="text-lg text-gray-600 mb-2">綜合評分:</p>
                            <p id="pitch-score" class="text-5xl font-extrabold text-purple-600">N/A</p>
                            <p class="text-sm text-gray-500 mt-2">（滿分 9 分，分數越高代表姿勢越符合理想標準）</p>
                        </div>
                    </div>
                    <div class="mt-6 text-center">
                        <button id="view-details-button" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-6 rounded-full transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-opacity-50 hidden">
                            查看詳細分析
                        </button>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow-lg p-6 flex flex-col">
                    <h2 class="text-2xl font-bold text-gray-700 mb-4">歷史紀錄</h2>
                    <div id="history-list" class="flex-grow overflow-y-auto max-h-64 border border-gray-200 rounded-md p-2 space-y-2">
                        <p class="text-gray-500 text-center py-4" id="no-history-message">暫無歷史紀錄。</p>
                    </div>
                    <button id="goto-history-button" class="mt-6 bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded-full transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50">
                        查看歷史數據分析
                    </button>
                </div>
            </section>
        </main>

        <footer class="mt-10 text-center text-gray-500 text-sm">
            <p>&copy; 2025 棒球投手分析儀表板. All rights reserved.</p>
        </footer>
    </div>

    <div id="history-analysis-page" class="hidden min-h-screen p-6 bg-gray-50 transition-all duration-300">
        <header class="mb-8 text-center">
            <h1 class="text-4xl font-extrabold text-green-700">📈 歷史數據分析 📊</h1>
            <p class="text-lg text-gray-600 mt-2">深入洞察您的投球表現趨勢</p>
            <button id="back-to-dashboard-button" class="mt-4 bg-gray-400 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-full transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:ring-opacity-50">
                ← 返回儀表板
            </button>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="bg-white rounded-lg shadow-lg p-6 col-span-full">
                <h2 class="text-2xl font-bold text-gray-700 mb-4">選擇歷史紀錄進行比較</h2>
                <select id="history-record-select" class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></select>
                <div id="selected-record-details" class="mt-4 p-4 bg-gray-50 rounded-md text-sm text-gray-700">
                    </div>
            </div>

            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-700 mb-4">投球分數分佈 (直方圖)</h2>
                <canvas id="pitchScoreHistogramChart"></canvas>
            </div>
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-700 mb-4">平均手肘角度分佈 (圓餅圖)</h2>
                <canvas id="avgElbowAnglePieChart"></canvas>
            </div>
            <div class="bg-white rounded-lg shadow-lg p-6 col-span-full">
                <h2 class="text-2xl font-bold text-gray-700 mb-4">運動力學特徵雷達圖</h2>
                <canvas id="biomechanicsRadarChart"></canvas>
            </div>
            </main>
    </div>

    <script type="module" src="js/api.js"></script>
    <script type="module" src="js/ui.js"></script>
    <script type="module" src="js/charts.js"></script>
    <script type="module" src="js/app.js"></script>
</body>
</html>